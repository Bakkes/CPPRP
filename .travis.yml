language: generic
python:
    - "3.6"


git:
  submodules: false
# Use sed to replace the SSH URL with the public URL, then initialize submodules
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' ".gitmodules"
  - git submodule update --init --recursive

matrix:
  include:
        - compiler: clang
          os: linux
          dist: xenial
          addons:
            apt:
              sources: ['ubuntu-toolchain-r-test', 'llvm-toolchain-xenial-8']
              packages: ['g++-9', 'clang++-8', 'clang-tidy-8']
          env:
            - NAME=clang8
            - CXX=clang++-8
            - CLANG_TIDY=clang-tidy-8
          script:
            - make RELEASE=1
        - compiler: clang
          os: linux
          dist: xenial
          addons:
            apt:
              sources: ['ubuntu-toolchain-r-test', 'llvm-toolchain-xenial-8']
              packages: ['g++-9', 'clang++-6.0', 'clang-tidy-6.0']
          env:
            - NAME=clang6
            - CXX=clang++-6.0
            - CLANG_TIDY=clang-tidy-6.0
          script:
            - make RELEASE=1
        - compiler: gcc
          os: linux
          dist: xenial
          addons:
            apt:
              sources: ['ubuntu-toolchain-r-test']
              packages: ['g++-9']
          env:
            - NAME=gcc
            - CXX=g++-9
          script:
            - make RELEASE=1
    
notifications:
  email: false
  
before_deploy:
      # Set up git user name and tag this commit
      #- git config --local user.name "YOUR GIT USER NAME"
      #- git config --local user.email "YOUR GIT USER EMAIL"
      #- export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
      #- git tag $TRAVIS_TAG
      mv "./build/test" "cpprp-$NAME-$TRAVIS_TAG"
deploy:
  provider: releases
  api_key: 
    secure: "DN8hCiocylYWyBUca3AScBFCcTwVlm9KzvMCLvc0jzpY4ltjKcrzP8piZy9wCnv2IZLRdddg24HrXw8mI3XEgR504uU0zJ//5paDpI9K7SydWGiLNJ5PNHaezTz0+HACwOVsIUe8zibJ/mItthw0SS2n32rlZqCoYaPInc5X7k6au6eu7qasVg7GYwOjb6Kq7coauYH2XXz6Y8DYUHNz3HAbr0mAf8k1GuzncZ/luXAOjzXGLRYw4kxQrjqW1WaKNyagtQZJbS+6xjoMaFcc7atLYXRv6aiLDc014HW/oHAqU1p3jZdRTbxV5jTT2h/Kxd23V43ght132ZzH2q1ck4z88/KMIyvKRPCZeJMMT1Pv5Qcn7sy+bC49y7ctUToHMAT7UMq+v4l4M+nDwoMo7gjCVuaAvGKRkRpV+6tP3F+Q2xIsfGb40wpuWhsdjjkWsIg1BlIdjBKpy3K72TBPTB90GaBOQMLMh5oXVnOzRFkhbTkh73xoC5C8O8+6ZcxsgdiP90vITakMBf8LhYiLOeReagtUjyEwpkOKD/r4XW1DK4tXeJBVDiRJMmJKw6zpIJlgjdoxSfwlujJyU32cUnX0PYBVIG+pPT9ojl81/T49/V66nYgsQAVmEe1kfwdytDiH6Yzgs2Py5Ef7MuvgPmuWjuzTs7da8SlB8snztP4="
  file: "cpprp-$NAME-$TRAVIS_TAG"
  skip_cleanup: true
  draft: true
  on: 
    tags: true
    branch: master
branches:
  only:
    - master
    - /^\d+\.\d+\.\d+.*$/ #https://travis-ci.community/t/pushing-tag-does-not-trigger-deployment-to-github-releases/3098
